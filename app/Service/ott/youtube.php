<?php

namespace App\Service\ott;

class youtube extends ottbase
{
    public $key = array('name');
    public $expireTime = 1800;

    public function getKey()
    {
        return $this->key;
    }

    public function getExpireTime()
    {
        return $this->expireTime;
    }

    public function getUrl($data)
    {
        $id = $data['name'];
        if (preg_match('/\w+/', $id) == false ) {
            return '403 forbidden';
        }

        $url = "https://www.youtube.com/watch?v={$id}";
        $url = escapeshellarg($url);

        $string = "youtube-dl -J {$url}";
        exec($string, $out, $status);
        if ($status != 0 || !isset($out[0])) {
            return false;
        }

        //$data = $out[0];

        //$data = '{"upload_date": "20161003", "extractor": "youtube", "chapters": null, "height": 240, "playlist_index": null, "view_count": 78407, "playlist": null, "title": "\u8840\u6218\u4e1b\u6797 \u96fb\u5f71 \u5c0d\u8d8a\u81ea\u885b\u53cd\u64ca\u6230", "dislike_count": 39, "width": 320, "uploader_url": "http://www.youtube.com/channel/UCwN4GWZboKAK41FfjWSn3YQ", "subtitles": {}, "season_number": null, "annotations": null, "acodec": "opus", "display_id": "2zkJoBIhfh4", "automatic_captions": {}, "format": "242 - 320x240 (240p)+251 - audio only (DASH audio)", "requested_subtitles": null, "start_time": null, "uploader": "ZW Cheng", "uploader_id": "UCwN4GWZboKAK41FfjWSn3YQ", "categories": ["Film & Animation"], "thumbnails": [{"url": "https://i.ytimg.com/vi/2zkJoBIhfh4/hqdefault.jpg", "id": "0"}], "artist": null, "extractor_key": "Youtube", "vcodec": "vp9", "channel_id": "UCwN4GWZboKAK41FfjWSn3YQ", "is_live": null, "end_time": null, "webpage_url": "https://www.youtube.com/watch?v=2zkJoBIhfh4", "formats": [{"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "format_note": "DASH audio", "protocol": "https", "format": "249 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=1CA8AE4AA8BC4792E2E085604EA52BC7509298AC.4C7C8FEF511A95C554D4E775C8F40FED8E2290B2&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fwebm&key=yt6&dur=5513.661&lmt=1491014194164258&keepalive=yes&clen=30077521&fvip=5&itag=249&requiressl=yes&ratebypass=yes", "vcodec": "none", "tbr": 55.346, "abr": 50, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "webm", "filesize": 30077521, "format_id": "249", "quality": -1, "acodec": "opus"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "format_note": "DASH audio", "protocol": "https", "format": "250 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=271B6BE225FC7074DD36744BAAF89A84DF11331B.2B70561E83D87AD86A524049BABDE7F9F0412BC8&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fwebm&key=yt6&dur=5513.661&lmt=1491014358381147&keepalive=yes&clen=37845496&fvip=5&itag=250&requiressl=yes&ratebypass=yes", "vcodec": "none", "tbr": 68.079, "abr": 70, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "webm", "filesize": 37845496, "format_id": "250", "quality": -1, "acodec": "opus"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "format_note": "DASH audio", "protocol": "https", "format": "171 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=0C1860EF5DC646AF4A575D3AEE6EE88741B3DEBE.BEEBDEC8F283D2A900545C161952482B3AD182E6&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fwebm&key=yt6&dur=5513.673&lmt=1491014184661368&keepalive=yes&clen=52718889&fvip=5&itag=171&requiressl=yes&ratebypass=yes", "vcodec": "none", "tbr": 90.025, "abr": 128, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "webm", "filesize": 52718889, "format_id": "171", "quality": -1, "acodec": "vorbis"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "tbr": 132.855, "container": "m4a_dash", "format": "140 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=7FCE97724E36D5AAF135317B6F0B760CED20C834.6516A648E5F0FD041CC11937CB124B478875D804&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fmp4&key=yt6&dur=5513.786&lmt=1532372031278916&keepalive=yes&clen=87572874&fvip=5&itag=140&requiressl=yes&ratebypass=yes", "vcodec": "none", "format_note": "DASH audio", "abr": 128, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "m4a", "filesize": 87572874, "protocol": "https", "format_id": "140", "quality": -1, "acodec": "mp4a.40.2"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "format_note": "DASH audio", "protocol": "https", "format": "251 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=57A2F2B168B89AECE40535F134477DD1F2824AC5.BA0B3C87EBC7160071018A75ED1B70B9EDA018A0&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fwebm&key=yt6&dur=5513.661&lmt=1491014462590319&keepalive=yes&clen=81015192&fvip=5&itag=251&requiressl=yes&ratebypass=yes", "vcodec": "none", "tbr": 142.652, "abr": 160, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "webm", "filesize": 81015192, "format_id": "251", "quality": -1, "acodec": "opus"}, {"format_note": "144p", "protocol": "https", "format": "160 - 192x144 (144p)", "tbr": 86.922, "height": 144, "downloader_options": {"http_chunk_size": 10485760}, "format_id": "160", "quality": -1, "http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&aitags=133%2C160%2C242%2C278&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=C3B180C4989DFED24ED952E9DA004D992D5E7063.74B039BCC5AB4C3975763F72C50036376453BB7F&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2Fmp4&key=yt6&dur=5513.732&lmt=1532371965392195&keepalive=yes&clen=34752996&fvip=5&itag=160&requiressl=yes&ratebypass=yes", "vcodec": "avc1.4d400b", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 192, "ext": "mp4", "filesize": 34752996, "fps": 15, "acodec": "none"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "tbr": 96.045, "container": "webm", "format": "278 - 192x144 (144p)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&aitags=133%2C160%2C242%2C278&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=64F7FF88734C9DBE90E03E99D4E65739D6ACF288.4C03490B47F1E191BC4469F16A53CCA0D435B173&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2Fwebm&key=yt6&dur=5513.666&lmt=1491024072388616&keepalive=yes&clen=49781679&fvip=5&itag=278&requiressl=yes&ratebypass=yes", "vcodec": "vp9", "format_note": "144p", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "width": 192, "ext": "webm", "filesize": 49781679, "fps": 15, "protocol": "https", "format_id": "278", "height": 144, "quality": -1, "acodec": "none"}, {"format_note": "240p", "protocol": "https", "format": "133 - 320x240 (240p)", "tbr": 198.078, "height": 240, "downloader_options": {"http_chunk_size": 10485760}, "format_id": "133", "quality": -1, "http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&aitags=133%2C160%2C242%2C278&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=98A4F1912AB8318FC6B32F3CB1E0A206DEF034E8.519E4DA60525B51792A1DB7201A35AEE088158A1&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2Fmp4&key=yt6&dur=5513.732&lmt=1532371885262092&keepalive=yes&clen=64655169&fvip=5&itag=133&requiressl=yes&ratebypass=yes", "vcodec": "avc1.4d400c", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 320, "ext": "mp4", "filesize": 64655169, "fps": 15, "acodec": "none"}, {"format_note": "240p", "protocol": "https", "format": "242 - 320x240 (240p)", "tbr": 223.887, "height": 240, "downloader_options": {"http_chunk_size": 10485760}, "format_id": "242", "quality": -1, "http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&aitags=133%2C160%2C242%2C278&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=DCFD71F88582ED68E2249C87B86702D0EFF1AE5F.1C6DD3910F700F19A7168ACD13E2620B575CD39F&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2Fwebm&key=yt6&dur=5513.666&lmt=1491024198498473&keepalive=yes&clen=83334445&fvip=5&itag=242&requiressl=yes&ratebypass=yes", "vcodec": "vp9", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 320, "ext": "webm", "filesize": 83334445, "fps": 15, "acodec": "none"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "protocol": "https", "format": "17 - 176x144 (small)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2F3gpp&key=yt6&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&dur=5513.856&signature=5DE6FC68CF44BC030AB8D0692A16F43899CC222D.683ED99B5A7F75C382E8FEEEF71D04E0C008922F&lmt=1475482313350732&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&clen=53504362&fvip=5&source=youtube&itag=17&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&requiressl=yes&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&ratebypass=yes", "vcodec": "mp4v.20.3", "format_note": "small", "ext": "3gp", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 176, "abr": 24, "filesize": 53504362, "format_id": "17", "height": 144, "resolution": "176x144", "acodec": "mp4a.40.2"}, {"protocol": "https", "format": "36 - 320x240 (small)", "format_note": "small", "height": 240, "format_id": "36", "http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2F3gpp&key=yt6&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&dur=5513.856&signature=7F7FD0AF23CAA3FC26577A15218FE9F904068516.322FBAB33DDAB15B6B3E97C2C3A81CE574A7B4B1&lmt=1475482322072203&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&clen=149289504&fvip=5&source=youtube&itag=36&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&requiressl=yes&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&ratebypass=yes", "vcodec": "mp4v.20.3", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 320, "ext": "3gp", "filesize": 149289504, "resolution": "320x240", "acodec": "mp4a.40.2"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "protocol": "https", "format": "18 - 384x288 (small)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=8DCA6BEC86656CE63FDFF88C8AC95F09E193D572.CF7D01C858BF3557B3E0990F4FCC341839F2DF98&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&mime=video%2Fmp4&key=yt6&dur=5513.733&lmt=1489604022607172&ratebypass=yes&clen=258038781&fvip=5&itag=18&requiressl=yes", "vcodec": "avc1.42001E", "format_note": "small", "ext": "mp4", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 384, "abr": 96, "filesize": 258038781, "format_id": "18", "height": 288, "resolution": "384x288", "acodec": "mp4a.40.2"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "protocol": "https", "format": "43 - 640x360 (medium)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=CC0A490F2A708C73B499D48FACACEB7E808E638F.9CE8F1C02876FFDCE8D1545D3231260C60A63132&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&mime=video%2Fwebm&key=yt6&dur=0.000&lmt=1475488332039069&ratebypass=yes&clen=303922066&fvip=5&itag=43&requiressl=yes", "quality": 1, "vcodec": "vp8.0", "format_note": "medium", "ext": "webm", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "width": 640, "abr": 128, "filesize": 303922066, "format_id": "43", "height": 360, "resolution": "640x360", "acodec": "vorbis"}], "age_limit": 0, "creator": null, "series": null, "like_count": 61, "duration": 5514, "id": "2zkJoBIhfh4", "requested_formats": [{"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "tbr": 223.887, "protocol": "https", "format": "242 - 320x240 (240p)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&aitags=133%2C160%2C242%2C278&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=DCFD71F88582ED68E2249C87B86702D0EFF1AE5F.1C6DD3910F700F19A7168ACD13E2620B575CD39F&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=video%2Fwebm&key=yt6&dur=5513.666&lmt=1491024198498473&keepalive=yes&clen=83334445&fvip=5&itag=242&requiressl=yes&ratebypass=yes", "vcodec": "vp9", "format_note": "240p", "height": 240, "downloader_options": {"http_chunk_size": 10485760}, "width": 320, "ext": "webm", "filesize": 83334445, "fps": 15, "format_id": "242", "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "quality": -1, "acodec": "none"}, {"http_headers": {"Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.7", "Accept-Language": "en-us,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0"}, "format_note": "DASH audio", "protocol": "https", "format": "251 - audio only (DASH audio)", "url": "https://r5---sn-a5meknsd.googlevideo.com/videoplayback?ipbits=0&ip=192.200.112.162&ei=0WfEW4XMKpCEkgaj3qCoDA&pl=24&ms=au%2Crdu&mt=1539598144&mv=u&source=youtube&signature=57A2F2B168B89AECE40535F134477DD1F2824AC5.BA0B3C87EBC7160071018A75ED1B70B9EDA018A0&c=WEB&id=o-ALypa_XlBdO9J5DS2n-xXBxlm7Aeoo7Hx4qqwdwqC0Pl&mm=31%2C29&gir=yes&mn=sn-a5meknsd%2Csn-a5mlrn7k&expire=1539619889&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&mime=audio%2Fwebm&key=yt6&dur=5513.661&lmt=1491014462590319&keepalive=yes&clen=81015192&fvip=5&itag=251&requiressl=yes&ratebypass=yes", "vcodec": "none", "tbr": 142.652, "abr": 160, "player_url": "/yts/jsbin/player-vflO1Ey5k/en_US/base.js", "downloader_options": {"http_chunk_size": 10485760}, "ext": "webm", "filesize": 81015192, "format_id": "251", "quality": -1, "acodec": "opus"}], "average_rating": 3.44000005722, "abr": 160, "fps": 15, "stretched_ratio": null, "channel_url": "http://www.youtube.com/channel/UCwN4GWZboKAK41FfjWSn3YQ", "thumbnail": "https://i.ytimg.com/vi/2zkJoBIhfh4/hqdefault.jpg", "webpage_url_basename": "watch", "description": "", "tags": ["\u5c0d\u8d8a\u81ea\u885b\u53cd\u64ca\u6230", "VHS"], "track": null, "format_id": "242+251", "episode_number": null, "license": null, "alt_title": null, "vbr": null, "ext": "webm", "resolution": null}';

        $data = json_decode($data, true);

        $videos = [];

        $formats = $data['formats'];
        foreach ($formats as $format) {

            if (strpos($format['format'], 'video only') === false &&
                isset($format['url']) &&
                $format['ext'] == 'mp4') {
                $videos[$format['format_note']] = $format['url'];
            }
        }

        return end($videos);

    }

}
